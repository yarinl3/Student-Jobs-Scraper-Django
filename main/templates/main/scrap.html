{% extends 'main/base.html' %}

{%block title%}Scrap Jobs{%endblock%}

{%block page_name %}Scrap Jobs{% endblock %}
{% load crispy_forms_tags %}
{% block content %}

<script>
    function toggle(source) {
        jobs_sites = ['alljobs', 'drushim', 'jobmaster', 'sqlink', 'telegram_jobs']
        for(var j=0; j<5; j++){
            checkboxes = document.getElementsByName(jobs_sites[j]);
            for(var i=0, n=checkboxes.length;i<n;i++) {
                checkboxes[i].checked = source.checked;
            }
        }
    }
</script>



    <form method="POST" action="#" class="form-group" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form|crispy }}
       <div class="input-group mb-3">
           <div class="custom-file">
               <input type="file" class="custom-file-input" id="upload" name="upload" accept="application/JSON">
               <label class="col-sm-4 custom-file-label" for="upload">Choose telegram json file</label>
           </div>
       </div>

        <button type="submit" name="save" class="btn btn-success">Scrap</button>
        <p>
            {% for error in errors %}
                {% if 'successfully' in error %}
                    <div class="alert alert-success" role="alert">
                        {{error}}
                    </div>
                {% else %}
                    <div class="alert alert-danger" role="alert">
                        {{error}}
                    </div>
                {% endif %}
        {% endfor %}
        </p>
    </form>

    <script>
        var uploadFile = document.getElementById('upload'); /* finds the input */
        function changeLabelText() {
            var uploadValue = uploadFile.value; /* gets the filepath and filename from the input */
            var fileNameStart = uploadValue.lastIndexOf('\\'); /* finds the end of the filepath */
            uploadValue = uploadValue.substr(fileNameStart + 1); /* isolates the filename */
            var uploadFileLabelText = document.querySelector('label[for="upload"]').childNodes[0]; /* finds the label text */
            if (uploadValue !== '') {
                uploadFileLabelText.textContent = uploadValue; /* changes the label text */
            }
        }
        uploadFile.addEventListener('change',changeLabelText,false);
    </script>
{% endblock %}
